<!DOCTYPE html>
<html lang="en">
<head>
    <title>Document</title>
    <style>
        .title{
            text-align: center;
            font-size: 30px;
            font-weight: bold;
        }

        .info{
            text-align: center;
            font-size: 20px;
        }
        .searchButtonCss{
            margin-top: 10px;
        }
        .loading-image{
            opacity: 0;
            margin-top: 15px;
        }
        .loading-image img{
            background-color: transparent;
            height: 100px;
            background-image: none;
        }
        .loading{
            opacity: 1;
        }

    </style>
</head>
<body>
    <p class="title">TIC TAC TOE</p>
     <div>
        <p id="users">You <span id="user"></span></p>
        <p id="opponents">Opponent <span id="opponent"></span></p>
        
     </div>
    <p id="play-choice">You play with:<span id="value"></span></p>

    <br>
    <p id="turn">X's Turn</p>

    <div class="info">
        <p id="enterName">Enter your Name:</p>
        <input type="text" placeholder="Name" id="name" autocomplete="off">
        <div class="searchButtonCss"><button id="searchButton">Search for a player</button></div>
        <div class="loading-image">
        <img  src="Loading_icon.gif" alt=""> </div>
    </div>

    
     

    <div id="game">
        <div id="gameTable">
            <button id="button1" class="button"></button>
            <button id="button2" class="button"></button>
            <button id="button3" class="button"></button>
            <button id="button4" class="button"></button>
            <button id="button5" class="button"></button>
            <button id="button6" class="button"></button>
            <button id="button7" class="button"></button>
            <button id="button8" class="button"></button>
            <button id="button9" class="button"></button>
        </div>

    </div>
</body>
<script src="./node_modules/socket.io/client-dist/socket.io.js"></script>
<script>
    document.getElementById('users').style.display='none'
    document.getElementById('opponents').style.display='none'
    document.getElementById('play-choice').style.display='none'
    document.getElementById('turn').style.display='none'
    document.getElementById('game').style.display='none'
    const socket=io();
    let name;
    document.getElementById('searchButton').addEventListener('click',()=>{
        name=document.getElementById('name').value

        document.getElementById('user').innerText=name
        if(!name){
            alert('enter a name')
        }
        else{
            socket.emit("search",{name})
            document.querySelector('.loading-image').classList.add('loading')
        }
    })

    socket.on('search',(tmp)=>{
        let allPlayersArray=tmp.allPlayers

        console.log(allPlayersArray)
        document.getElementById('users').style.display='block'
        document.getElementById('opponents').style.display='block'
        document.getElementById('play-choice').style.display='block'
        document.getElementById('turn').style.display='block'
        document.getElementById('searchButton').style.display='none'
        document.getElementById('enterName').style.display='none'
        document.getElementById('game').style.display='block'
        document.getElementById('name').style.display='none'
        document.getElementById('turn').style.display="X's turn"

        document.querySelector('.loading-image').classList.remove('loading')


        let oppName
        let value
        
        const foundObj = allPlayersArray.find(obj => obj.firstPlayer.firstPlayerName === name || obj.secondPlayer.secondPlayerName === name);

        if (foundObj) {
            if (foundObj.firstPlayer.firstPlayerName === name) {
                oppName = foundObj.secondPlayer.secondPlayerName;
                value = foundObj.firstPlayer.firstPlayerValue;
            } else {
                oppName = foundObj.firstPlayer.firstPlayerName;
                value = foundObj.secondPlayer.secondPlayerValue;
            }

            document.getElementById('opponent').innerText = oppName;
            document.getElementById('value').innerText = value;
        }

    })
</script>
</html>